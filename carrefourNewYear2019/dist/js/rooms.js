"use strict";var _createClass=function(){function n(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,s){return e&&n(t.prototype,e),s&&n(t,s),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Rooms=function(){function e(t){_classCallCheck(this,e),this.domain=t.domain,this.roomId=null,this.qrcode={},this.socket={},this.status=null,this.sort=null,this.user_count=0,this.width=0,this.keyman=!1,this.player=null,this.check_event=null,this.video_cut=1,this.wt=null,this.gtm=t.gtm_event||[],this.nextStep=t.nextStep||function(){},this.YTlist=t.YTlist||["I7dZ98TBXks","BG6FecSsBDw","BHJ3V18nusk"]}return _createClass(e,[{key:"connect",value:function(){try{if(this.socket.connected||"connecting"==this.status)return;this.status="connecting";var s=this;s.roomId=findGetParameter("roomId"),s.socket=io(s.domain),s.socket.on("connect",function(){s.socket.emit("join",s.roomId,device)}),s.socket.on("disconnect",function(){console.warn("socket server disconnect"),"played"==s.status||"playing"==s.status&&3==s.video_cut||s.reset()}),s.socket.on("events",function(t){switch(t.event){case"room_over":s.status="room_over";break;case"user_full":s.status="before_play",s.user_count=t.user_count,s.sort=t.sort,s.width=t.room_width;var e=20;s.wt=setInterval(function(){var t=!1;--e<5&&!t&&(t=!0,s.socket.emit("video_check",s.roomId)),e<=0&&(alert("糟糕! 有人網路怪怪的!\n請保持最佳網速以享有流暢觀影體驗。"),clearInterval(s.wt),s.reset(),s.socket.disconnect())},1e3),s.nextStep(2);break;case"user_count":s.user_count=t.user_count;break;case"room_wait":s.status="wait",s.nextStep(1);break;case"play_video":s.nextStep(3);break;case"video_ready":s.status="video_ready",s.wt&&clearInterval(s.wt);break;case"user_quit":s.status="wait",s.user_count=t.user_count,s.gtm("M秘映版_popup_有人先離開");break;case"close_room":"wait"==s.status&&(s.gtm("M秘映版_邀請逾時"),alert("邀請逾時，請重新揪團觀賞秘映劇場版!")),("video_ready"==s.status||"before_play"==s.status||"playing"==s.status&&3!=s.video_cut)&&alert("唉呀! 您有朋友先行離場了\n本片需要三人到齊才能播映\n快揪好友再看一次搶抽一年份電影票!"),"played"==s.status||"playing"==s.status&&3==s.video_cut||s.reset(),s.socket.disconnect();break;case"keyman":s.keyman=!0}})}catch(t){console.warn(t)}}},{key:"reset",value:function(){console.warn("room restart"),this.qrcode={},this.status=null,this.sort=null,this.user_count=0,this.keyman=!1,this.player=null,this.nextStep(0),this.check_event&&clearInterval(this.check_event),this.wt&&clearInterval(this.wt)}},{key:"YTinit",value:function(){var e=this,s=!1;function n(){150<e.player.getCurrentTime()&&2==e.video_cut&&(e.video_cut=3,clearInterval(e.check_event))}e.player=new YT.Player("player",{height:"100%",width:"100%",videoId:e.YTlist[e.sort],playerVars:{controls:0,disablekb:1,rel:0,enablejsapi:1,showinfo:0,iv_load_policy:3,modestbranding:1,playlist:"",start:3,playsinline:1},events:{onReady:function(t){t.target.playVideo(),t.target.mute(),e.socket.emit("video_ready",e.roomId)},onError:function(){},onStateChange:function(t){t.data==YT.PlayerState.BUFFERING&&t.target.setPlaybackQuality("medium"),t.data!=YT.PlayerState.PLAYING||s||(e.check_event=setInterval(n,1e3),s=!0),t.data==YT.PlayerState.ENDED&&("playing"==e.status?(e.status="played",e.nextStep(4)):(alert("等待逾時，請重新揪團觀賞秘映劇場版!"),e.reset()))}}})}},{key:"close",value:function(){this.socket.emit("close_room",this.roomId)}},{key:"video_start",value:function(){this.socket.emit("play_click",this.roomId)}},{key:"createQR",value:function(){this.qrcode=qrcode(0,"M"),this.qrcode.addData(""+window.location.origin+window.location.pathname+"?roomId="+this.roomId),this.qrcode.make(),document.getElementById("qrcode").innerHTML=this.qrcode.createImgTag()}}]),e}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvb21zLmpzIl0sIm5hbWVzIjpbIlJvb21zIiwib3B0aW9ucyIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJkb21haW4iLCJyb29tSWQiLCJxcmNvZGUiLCJzb2NrZXQiLCJzdGF0dXMiLCJzb3J0IiwidXNlcl9jb3VudCIsIndpZHRoIiwiZ3RtX2V2ZW50IiwibmV4dFN0ZXAiLCJZVGxpc3QiLCJfc2VsZiIsImZpbmRHZXRQYXJhbWV0ZXIiLCJpbyIsIm9uIiwiZW1pdCIsImRldmljZSIsImNvbnNvbGUiLCJ2aWRlb19jdXQiLCJzZXJ2ZXIiLCJldmVudCIsInJvb21fd2lkdGgiLCJ3aWF0X3RpbWUiLCJ3dCIsInNldEludGVydmFsIiwiZGMiLCJhbGVydCIsImNsZWFySW50ZXJ2YWwiLCJndG0iLCJlcnIiLCJ3YXJuIiwia2V5bWFuIiwicGxheWVyIiwiY2hlY2tfZXZlbnQiLCJkb25lIiwiZ2V0Q3VycmVudFRpbWUiLCJZVCIsIlBsYXllciIsInZpZGVvSWQiLCJwbGF5ZXJWYXJzIiwiY29udHJvbHMiLCJkaXNhYmxla2IiLCJyZWwiLCJoZWlnaHQiLCJldmVudHMiLCJvblJlYWR5IiwiZSIsInRhcmdldCIsInBsYXlWaWRlbyIsIm11dGUiLCJvbkVycm9yIiwib25TdGF0ZUNoYW5nZSIsImRhdGEiLCJQbGF5ZXJTdGF0ZSIsIkJVRkZFUklORyIsIlBMQVlJTkciLCJjaGVja19jdXJyZW50IiwiRU5ERUQiLCJhZGREYXRhIiwid2luZG93IiwibG9jYXRpb24iLCJvcmlnaW4iLCJwYXRobmFtZSIsIm1ha2UiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiY3JlYXRlSW1nVGFnIl0sIm1hcHBpbmdzIjoiaVlBQU1BLGlCQUNGLFNBQUFBLEVBQVlDLEdBQVNDLGdCQUFBQyxLQUFBSCxHQUNqQkcsS0FBS0MsT0FBU0gsRUFBUUcsT0FDdEJELEtBQUtFLE9BQVMsS0FDZEYsS0FBS0csT0FBUyxHQUNkSCxLQUFLSSxPQUFTLEdB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V0FBQS9ELEtBQUFFLFFBVUdGLEtBQUtHLE9BQU82RCxPQUNaQyxTQUFTQyxlQUFlLFVBQVVDLFVBQVluRSxLQUFLRyxPQUFPaUUiLCJmaWxlIjoicm9vbXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBSb29tcyB7XHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7ICAgICAgICBcclxuICAgICAgICB0aGlzLmRvbWFpbiA9IG9wdGlvbnMuZG9tYWluO1xyXG4gICAgICAgIHRoaXMucm9vbUlkID0gbnVsbDtcclxuICAgICAgICB0aGlzLnFyY29kZSA9IHt9O1xyXG4gICAgICAgIHRoaXMuc29ja2V0ID0ge307XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc29ydCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy51c2VyX2NvdW50ID0gMDtcclxuICAgICAgICB0aGlzLndpZHRoID0gMDtcclxuICAgICAgICB0aGlzLmtleW1hbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucGxheWVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNoZWNrX2V2ZW50ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnZpZGVvX2N1dCA9IDE7XHJcbiAgICAgICAgdGhpcy53dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5ndG0gPSBvcHRpb25zLmd0bV9ldmVudCB8fCBbXVxyXG4gICAgICAgIHRoaXMubmV4dFN0ZXAgPSBvcHRpb25zLm5leHRTdGVwIHx8IGZ1bmN0aW9uICgpIHsgfTtcclxuICAgICAgICB0aGlzLllUbGlzdCA9IG9wdGlvbnMuWVRsaXN0IHx8IFsnSTdkWjk4VEJYa3MnLCAnQkc2RmVjU3NCRHcnLCAnQkhKM1YxOG51c2snXVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIGNvbm5lY3QoKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc29ja2V0LmNvbm5lY3RlZCB8fCB0aGlzLnN0YXR1cyA9PSAnY29ubmVjdGluZycpIHtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwic29ja2V0IGNvbm5lY3RlZCBvciBjb25uZWN0aW5nXCIpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJyVjc29ja2V0IGNvbm5lY3QnLCAnY29sb3I6Z3JlZW47Jyk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gJ2Nvbm5lY3RpbmcnO1xyXG4gICAgICAgICAgICB2YXIgX3NlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICBfc2VsZi5yb29tSWQgPSBmaW5kR2V0UGFyYW1ldGVyKFwicm9vbUlkXCIpO1xyXG4gICAgICAgICAgICBfc2VsZi5zb2NrZXQgPSBpbyhfc2VsZi5kb21haW4pO1xyXG5cclxuICAgICAgICAgICAgX3NlbGYuc29ja2V0Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCIlY2lvIGNvbm5lY3QgcnVuLi4uLlwiLCAnY29sb3I6Z3JlZW47Jyk7XHJcbiAgICAgICAgICAgICAgICBfc2VsZi5zb2NrZXQuZW1pdCgnam9pbicsIF9zZWxmLnJvb21JZCwgZGV2aWNlKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgX3NlbGYuc29ja2V0Lm9uKCdkaXNjb25uZWN0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdzb2NrZXQgc2VydmVyIGRpc2Nvbm5lY3QnKVxyXG4gICAgICAgICAgICAgICAgaWYgKF9zZWxmLnN0YXR1cyAhPSAncGxheWVkJyAmJiAhKF9zZWxmLnN0YXR1cyA9PSAncGxheWluZycgJiYgX3NlbGYudmlkZW9fY3V0ID09IDMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3NlbGYucmVzZXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgX3NlbGYuc29ja2V0Lm9uKCdldmVudHMnLCBmdW5jdGlvbiAoc2VydmVyKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgJWNTZXJ2ZXI6OmAsICdjb2xvcjpncmVlbjsnLCBzZXJ2ZXIpO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChzZXJ2ZXIuZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdyb29tX292ZXInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlvbHlu7Pkurrmlbjlt7Lmu7/vvIznhKHms5XliqDlhaVcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYuc3RhdHVzID0gJ3Jvb21fb3Zlcic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VzZXJfZnVsbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZWxmLnN0YXR1cyA9ICdiZWZvcmVfcGxheSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYudXNlcl9jb3VudCA9IHNlcnZlci51c2VyX2NvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi5zb3J0ID0gc2VydmVyLnNvcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZWxmLndpZHRoID0gc2VydmVyLnJvb21fd2lkdGhcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdpYXRfdGltZSA9IDIwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi53dCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lhdF90aW1lLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2lhdF90aW1lIDwgNSAmJiAhZGMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYuc29ja2V0LmVtaXQoJ3ZpZGVvX2NoZWNrJywgX3NlbGYucm9vbUlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aWF0X3RpbWUgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCfns5/ns5UhIOacieS6uue2sui3r+aAquaAqueahCFcXG7oq4vkv53mjIHmnIDkvbPntrLpgJ/ku6XkuqvmnInmtYHmmqLop4DlvbHpq5TpqZfjgIInKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoX3NlbGYud3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zZWxmLnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZWxmLm5leHRTdGVwKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd1c2VyX2NvdW50JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYudXNlcl9jb3VudCA9IHNlcnZlci51c2VyX2NvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdyb29tX3dhaXQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi5zdGF0dXMgPSAnd2FpdCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYubmV4dFN0ZXAoMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncGxheV92aWRlbyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZWxmLm5leHRTdGVwKDMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ZpZGVvX3JlYWR5JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYuc3RhdHVzID0gJ3ZpZGVvX3JlYWR5JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9zZWxmLnd0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKF9zZWxmLnd0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd1c2VyX3F1aXQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi5zdGF0dXMgPSAnd2FpdCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYudXNlcl9jb3VudCA9IHNlcnZlci51c2VyX2NvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi5ndG0oXCJN56eY5pig54mIX3BvcHVwX+acieS6uuWFiOmboumWi1wiKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2xvc2Vfcm9vbSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfc2VsZi5zdGF0dXMgPT0gJ3dhaXQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi5ndG0oJ03np5jmmKDniYhf6YKA6KuL6YC+5pmCJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIumCgOiri+mAvuaZgu+8jOiri+mHjeaWsOaPquWcmOingOiznuenmOaYoOWKh+WgtOeJiCFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9zZWxmLnN0YXR1cyA9PSAndmlkZW9fcmVhZHknXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgX3NlbGYuc3RhdHVzID09ICdiZWZvcmVfcGxheScgfHwgKF9zZWxmLnN0YXR1cyA9PSAncGxheWluZycgJiYgX3NlbGYudmlkZW9fY3V0ICE9IDMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIuWUieWRgCEg5oKo5pyJ5pyL5Y+L5YWI6KGM6Zui5aC05LqGXFxu5pys54mH6ZyA6KaB5LiJ5Lq65Yiw6b2K5omN6IO95pKt5pigXFxu5b+r5o+q5aW95Y+L5YaN55yL5LiA5qyh5pC25oq95LiA5bm05Lu96Zu75b2x56WoIVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3NlbGYuc3RhdHVzICE9ICdwbGF5ZWQnICYmICEoX3NlbGYuc3RhdHVzID09ICdwbGF5aW5nJyAmJiBfc2VsZi52aWRlb19jdXQgPT0gMykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zZWxmLnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAna2V5bWFuJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYua2V5bWFuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihlcnIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICByZXNldCgpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ3Jvb20gcmVzdGFydCcpO1xyXG4gICAgICAgIHRoaXMucXJjb2RlID0ge307XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc29ydCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy51c2VyX2NvdW50ID0gMDtcclxuICAgICAgICB0aGlzLmtleW1hbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucGxheWVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLm5leHRTdGVwKDApO1xyXG4gICAgICAgIGlmICh0aGlzLmNoZWNrX2V2ZW50KSB7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5jaGVja19ldmVudClcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMud3QpIHtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnd0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgWVRpbml0KCkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCclY1lUIGluaXQnLCAnY29sb3I6cmVkOycpO1xyXG4gICAgICAgIHZhciBfc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGRvbmUgPSBmYWxzZTtcclxuICAgICAgICBfc2VsZi5wbGF5ZXIgPSBuZXcgWVQuUGxheWVyKCdwbGF5ZXInLCB7XHJcbiAgICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxyXG4gICAgICAgICAgICB3aWR0aDogJzEwMCUnLFxyXG4gICAgICAgICAgICB2aWRlb0lkOiBfc2VsZi5ZVGxpc3RbX3NlbGYuc29ydF0sIC8veDNiRGh0dUM1eWsgM1kwVXQ1b3phS3NcclxuICAgICAgICAgICAgcGxheWVyVmFyczoge1xyXG4gICAgICAgICAgICAgICAgJ2NvbnRyb2xzJzogMCxcclxuICAgICAgICAgICAgICAgICdkaXNhYmxla2InOiAxLFxyXG4gICAgICAgICAgICAgICAgJ3JlbCc6IDAsXHJcbiAgICAgICAgICAgICAgICAnZW5hYmxlanNhcGknOiAxLFxyXG4gICAgICAgICAgICAgICAgJ3Nob3dpbmZvJzogMCxcclxuICAgICAgICAgICAgICAgICdpdl9sb2FkX3BvbGljeSc6IDMsXHJcbiAgICAgICAgICAgICAgICAnbW9kZXN0YnJhbmRpbmcnOiAxLFxyXG4gICAgICAgICAgICAgICAgJ3BsYXlsaXN0JzogJycsXHJcbiAgICAgICAgICAgICAgICAnc3RhcnQnOiAzLFxyXG4gICAgICAgICAgICAgICAgJ3BsYXlzaW5saW5lJzogMVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBldmVudHM6IHtcclxuICAgICAgICAgICAgICAgICdvblJlYWR5JzogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5wbGF5VmlkZW8oKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5tdXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgX3NlbGYuc29ja2V0LmVtaXQoJ3ZpZGVvX3JlYWR5JywgX3NlbGYucm9vbUlkKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAnb25FcnJvcic6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAvLyBjb25zb2xlLmxvZygnJUVycm9yJywgZXZlbnQsICdiYWNrZ3JvdW5kOnJlZDsnKTsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgJ29uU3RhdGVDaGFuZ2UnOiBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnJWNjaGFuZ2U6OicsICdiYWNrZ3JvdW5kOiNmZmZmMDA7JywgZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kYXRhID09IFlULlBsYXllclN0YXRlLkJVRkZFUklORykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnNldFBsYXliYWNrUXVhbGl0eSgnbWVkaXVtJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kYXRhID09IFlULlBsYXllclN0YXRlLlBMQVlJTkcgJiYgIWRvbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYuY2hlY2tfZXZlbnQgPSBzZXRJbnRlcnZhbChjaGVja19jdXJyZW50LCAxMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kYXRhID09IFlULlBsYXllclN0YXRlLkVOREVEKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfc2VsZi5zdGF0dXMgPT0gJ3BsYXlpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi5zdGF0dXMgPSAncGxheWVkJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYubmV4dFN0ZXAoNCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIuetieW+hemAvuaZgu+8jOiri+mHjeaWsOaPquWcmOingOiznuenmOaYoOWKh+WgtOeJiCFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi5yZXNldCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNoZWNrX2N1cnJlbnQoKSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJyX3NlYyA9IF9zZWxmLnBsYXllci5nZXRDdXJyZW50VGltZSgpO1xyXG4gICAgICAgICAgICBpZiAoY3Vycl9zZWMgPiAxNTAgJiYgX3NlbGYudmlkZW9fY3V0ID09IDIgKSB7XHJcbiAgICAgICAgICAgICAgICBfc2VsZi52aWRlb19jdXQgPSAzO1xyXG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChfc2VsZi5jaGVja19ldmVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgICAgdGhpcy5zb2NrZXQuZW1pdCgnY2xvc2Vfcm9vbScsIHRoaXMucm9vbUlkKTtcclxuICAgIH1cclxuICAgIHZpZGVvX3N0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMuc29ja2V0LmVtaXQoJ3BsYXlfY2xpY2snLCB0aGlzLnJvb21JZCk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGVRUigpIHtcclxuICAgICAgICB0aGlzLnFyY29kZSA9IHFyY29kZSgwLCAnTScpO1xyXG4gICAgICAgIHRoaXMucXJjb2RlLmFkZERhdGEoYCR7d2luZG93LmxvY2F0aW9uLm9yaWdpbn0ke3dpbmRvdy5sb2NhdGlvbi5wYXRobmFtZX0/cm9vbUlkPSR7dGhpcy5yb29tSWR9YCk7XHJcbiAgICAgICAgdGhpcy5xcmNvZGUubWFrZSgpO1xyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicXJjb2RlXCIpLmlubmVySFRNTCA9IHRoaXMucXJjb2RlLmNyZWF0ZUltZ1RhZygpO1xyXG4gICAgfVxyXG59Il19
