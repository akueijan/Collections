"use strict";var index_view=new Vue({el:"#app",data:{gamePop:!1,exPop:!1,eggPop:!1,prodsPop:!1,perdataPop:null,kvideoPop:!1,finishPop:!1,joinedPop:!1,rolePop:!1,awardPop:!1,video_step:0,room:null,timeout:null,timer:60,opening:!1,window_close:!1,sec:3,token:"",probability:0,base64Img:"",capKey:"",inputCap:"",inputName:"",inputMobile:"",inputEmail:"",luckyAward:0,awardItem:"",mute:!0,checkagree:!1,checkwish:!1,lonely:null,room_domain:"https://node-carrefour201901.azurewebsites.net",game:{prodPop:!1}},methods:{windowScroll:function(){var t=this;$(window).scroll(function(){var o=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),e=$("#easter-egg-title").offset().top;o>e-t.navHeight+30?(t.stopIssue(".nav",e-t.navHeight-120),t.stopIssue(".window",e-t.navHeight-120)):(t.overStopIssue(".nav"),t.overStopIssue(".window"))})},gameOpen:function(){this.endDate()?alert("活動已結束，2/28前將於活動網站公布得獎名單"):(this.gamePop=!0,this.navIssue(),this.clearData())},allPopupClose:function(){var o=this;o.gamePop=!1,o.exPop=!1,o.eggPop=!1,o.prodsPop=!1,o.kvideoPop=!1,o.finishPop=!1,o.joinedPop=!1,o.rolePop=!1,o.awardPop=!1,o.game.prodPop=!1,o.perdataPop=null},navIssue:function(){$("nav").hasClass("upissue")?$("nav").removeClass("upissue"):$("nav").addClass("upissue")},awardIssue:function(){window.alert("得獎名單將於2019/2/28前公布，敬請期待。")},step_next:function(o){this.video_step=o},stopIssue:function(o,e){$(o).addClass("active"),$(o).css("top",e)},overStopIssue:function(o){$(o).removeClass("active"),$(o).css("top",0)},createRoom:function(){if(this.endDate())alert("活動已結束，2/28前將於活動網站公布得獎名單");else{var o=document.location.search.substr(1),e="",t=guid();e=""!=o?o.match(/roomId/g)?o.split("roomId=")[0].replace(/&^/,"")+"&roomId="+t:o+"&roomId="+t:"roomId="+t,window.history.replaceState(null,document.title,"?"+e),this.room=new Rooms({gtm_event:this.gaEvant,domain:this.room_domain,nextStep:this.step_next}),this.awardItem="0"}},setTimer:function(){var o=this;o.timer=60,clearInterval(o.timeout),o.timeout=setInterval(function(){o.timer--},1e3)},video_start:function(){this.room.video_start()},eggRandom:function(o){Math.floor(Math.random()*o)},videoPlay:function(o){var e=this.video_link[o-1];this.kvideoPop=!0,kvideo.loadVideoById(e),kvideo.unMute(),kvideo.playVideo()},videoPlayLink:function(){this.kvideoPop=!0},videoClose:function(o){this.kvideoPop=!1,kvideo.stopVideo(),this.popupClose()},roomConnet:function(){this.room.connect()},video_mute:function(){this.room.player&&(this.mute=!this.mute,this.room.player.isMuted()?this.room.player.unMute():this.room.player.mute())},video_done:function(){this.room.player.seekTo(117)},video_play:function(){this.room.player.playVideo()},video_close:function(){this.room.socket.disconnect(),this.room=null,window.history.replaceState(null,document.title,document.location.search.split("roomId")[0])},lonely_play:function(){var e=this;e.room.socket.disconnect(),e.lonely=new YT.Player("lonely--player",{height:"100%",width:"100%",videoId:"2zO2qzehf1A",playerVars:{controls:0,disablekb:1,rel:0,enablejsapi:1,showinfo:0,iv_load_policy:3,modestbranding:1,playlist:"",start:3,playsinline:1},events:{onReady:function(o){o.target.unMute(),o.target.playVideo()},onStateChange:function(o){o.data==YT.PlayerState.ENDED&&(e.step_next(4),e.lonely=null)}}}),console.log(e.lonely)},lonely_close:function(){this.lonely.stopVideo(),$("#lonely--player").remove(),$(".lonely-content").append("<div id='lonely--player'/>"),this.lonely=null,this.video_close()},open_video_form:function(){var e=this;e.getToken().then(function(o){e.token=o.token,e.perdataPop="room",e.room=null,e.saveCaptcha()})}},watch:{video_step:function(o){var e=this;switch(o){case 1:e.$nextTick(function(){e.room.status,e.room.createQR(),e.room.keyman&&e.setTimer()});break;case 2:e.$nextTick(function(){clearInterval(e.timeout),e.room.YTinit()});break;case 3:e.$nextTick(function(){e.room.video_cut=1,e.sec=3,$(".controll").addClass("start");var o=setInterval(function(){e.sec--,e.sec<=0&&(clearInterval(o),$(".controll").removeClass("start"),setTimeout(function(){e.room.video_cut=2,e.room.status="playing",e.room.player.seekTo?e.room.player.seekTo(0,!0):e.room.player.playVideo()},300))},1500)});break;case 4:e.room.socket.disconnect()}},timer:function(o){o<=0&&(clearInterval(this.timeout),this.timer=60,this.room.close())},room:{deep:!0,handler:function(o){var e=this;o?("room_over"==o.status&&(alert("影廳人數已滿，無法加入"),e.room.socket.disconnect(),e.room=null),"wait"==o.status&&(e.video_step=1),o.status,null===o.status&&(e.video_step=0),$("body").addClass("_freeze")):(e.timeout&&clearInterval(e.timeout),$("body").removeClass("_freeze"),$("html, body").scrollTop($("#kv-bottom").offset().top-50))}}},computed:{sortClass:function(){return{center:0==this.room.sort,left:1==this.room.sort,right:2==this.room.sort}},videoClass:function(){return{word:0==this.video_step||4==this.video_step,join:1==this.video_step,play:2==this.video_step}},mediaStyle:function(){return{width:this.room.width+"px"}},borderStyle:function(){return{"border-width":this.room.width/2+"px"}}},mounted:function(){var o=this;o.showProj(),findGetParameter("roomId")&&(o.room=new Rooms({gtm_event:o.gaEvant,domain:o.room_domain,nextStep:o.step_next}),o.awardItem="0",o.roomConnet()),o.isPC=!1,$("#video-group").slick({centerMode:!0,variableWidth:!0,autoplay:!0,autoplaySpeed:2e3,pauseOnHover:!1,pauseOnFocus:!1,arrows:!1}),$("#game-slick").slick({centerMode:!0,variableWidth:!0,autoplay:!0,autoplaySpeed:2e3,pauseOnHover:!1,pauseOnFocus:!1,arrows:!1});var e=document.getElementById("window-loading-left"),t=document.getElementById("window-loading-right");e.classList.add("active"),t.classList.add("active"),o.awardPop=!0,o.popupOpen()}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4X21vYmlsZS5qcyJdLCJuYW1lcyI6WyJpbmRleF92aWV3IiwiVnVlIiwiZWwiLCJnYW1lUG9wIiwiZGF0YSIsImV4UG9wIiwiZWdnUG9wIiwicHJvZHNQb3AiLCJwZXJkYXRhUG9wIiwia3ZpZGVvUG9wIiwiZmluaXNoUG9wIiwiam9pbmVkUG9wIiwicm9sZVBvcCIsImF3YXJkUG9wIiwidmlkZW9fc3RlcCIsInJvb20iLCJ0aW1lb3V0IiwidGltZXIiLCJvcGVuaW5nIiwid2luZG93X2Nsb3NlIiwic2VjIiwidG9rZW4iLCJwcm9iYWJpbGl0eSIsImJhc2U2NEltZyIsImNhcEtleSIsImlucHV0Q2FwIiwiaW5wdXROYW1lIiwiaW5wdXRNb2JpbGUiLCJpbnB1dEVtYWlsIiwibHVja3lBd2FyZCIsImF3YXJkSXRlbSIsIm11dGUiLCJjaGVja2FncmVlIiwiY2hlY2t3aXNoIiwibG9uZWx5Iiwicm9vbV9kb21haW4iLCJtZXRob2RzIiwid2luZG93U2Nyb2xsIiwidm0iLCJ0aGlzIiwic2Nyb2xsIiwiTWF0aCIsIm1heCIsIndpbmRvdyIsInBhZ2VZT2Zmc2V0IiwiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiLCJzY3JvbGxUb3AiLCJib2R5Iiwic3RvcEhlaWdodCIsIiQiLCJvZmZzZXQiLCJ0b3AiLCJ3aW5kb3dTY3JvbGxUb3AiLCJuYXZIZWlnaHQiLCJzdG9wSXNzdWUiLCJvdmVyU3RvcElzc3VlIiwiZ2FtZU9wZW4iLCJlbmREYXRlIiwibmF2SXNzdWUiLCJhbGxQb3B1cENsb3NlIiwiY2xlYXJEYXRhIiwiaGFzQ2xhc3MiLCJpc3N1ZSIsInJlbW92ZUNsYXNzIiwiYXdhcmRJc3N1ZSIsImFsZXJ0IiwidmFsIiwiaXRlbSIsImhlaWdodCIsImFkZENsYXNzIiwiY3NzIiwiY3JlYXRlUm9vbSIsInVybFF1ZXJ5IiwibG9jYXRpb24iLCJzZWFyY2giLCJzdWJzdHIiLCJyb29tX2lkIiwiZ3VpZCIsInNwbGl0IiwicmVwbGFjZSIsInRpdGxlIiwiUm9vbXMiLCJyZXBsYWNlU3RhdGUiLCJkb21haW4iLCJndG1fZXZlbnQiLCJzdGVwX25leHQiLCJuZXh0U3RlcCIsInNldFRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsInNldEludGVydmFsIiwidmlkZW9fc3RhcnQiLCJlZ2dSYW5kb20iLCJmbG9vciIsInJhbmRvbSIsIngiLCJ2aWRlb0lkIiwidmlkZW9fbGluayIsImluZGV4IiwidmlkZW9QbGF5Iiwia3ZpZGVvIiwicGxheVZpZGVvIiwidmlkZW9DbG9zZSIsInBvcHVwQ2xvc2UiLCJzdG9wVmlkZW8iLCJyb29tQ29ubmV0IiwiY29ubmVjdCIsInBsYXllciIsImlzTXV0ZWQiLCJ1bk11dGUiLCJ2aWRlb19kb25lIiwic2Vla1RvIiwidmlkZW9fcGxheSIsInZpZGVvX2Nsb3NlIiwibG9uZWx5X3BsYXkiLCJoaXN0b3J5Iiwic29ja2V0IiwiZGlzY29ubmVjdCIsIllUIiwiUGxheWVyIiwid2lkdGgiLCJwbGF5ZXJWYXJzIiwiZW5hYmxlanNhcGkiLCJzaG93aW5mbyIsIml2X2xvYWRfcG9saWN5IiwibW9kZXN0YnJhbmRpbmciLCJwbGF5bGlzdCIsInN0YXJ0IiwicGxheXNpbmxpbmUiLCJldmVudHMiLCJvblJlYWR5IiwiZSIsInRhcmdldCIsImV2ZW50IiwiUGxheWVyU3RhdGUiLCJFTkRFRCIsImNvbnNvbGUiLCJsb2ciLCJsb25lbHlfY2xvc2UiLCJyZW1vdmUiLCJhcHBlbmQiLCJvcGVuX3ZpZGVvX2Zvcm0iLCJnZXRUb2tlbiIsInRoZW4iLCJyZXMiLCJ3YXRjaCIsIm5ld1ZhbCIsIiRuZXh0VGljayIsInN0YXR1cyIsImtleW1hbiIsIllUaW5pdCIsInZpZGVvX2N1dCIsInNlY19kb3duIiwic2V0VGltZW91dCIsImNsb3NlIiwiZGVlcCIsImhhbmRsZXIiLCJvYmoiLCJjb21wdXRlZCIsInNvcnRDbGFzcyIsImNlbnRlciIsInNvcnQiLCJyaWdodCIsInZpZGVvQ2xhc3MiLCJ3b3JkIiwicGxheSIsIm1lZGlhU3R5bGUiLCJib3JkZXJTdHlsZSIsImJvcmRlci13aWR0aCIsIm1vdW50ZWQiLCJzaG93UHJvaiIsImZpbmRHZXRQYXJhbWV0ZXIiLCJnYUV2YW50Iiwic2xpY2siLCJjZW50ZXJNb2RlIiwiaXNQQyIsImF1dG9wbGF5IiwidmFyaWFibGVXaWR0aCIsImF1dG9wbGF5U3BlZWQiLCJwYXVzZU9uRm9jdXMiLCJhcnJvd3MiLCJnZXRFbGVtZW50QnlJZCIsIndpbmRvd0xlZnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ3aW5kb3dSaWdodCIsInBvcHVwT3BlbiJdLCJtYXBwaW5ncyI6ImFBQUEsSUFBSUEsV0FBYSxJQUFJQyxJQUFJLENBQ3JCQyxHQUFJLE9BREpGLEtBQUFBLENBQ0lHLFNBRGlCLEVBRXJCQyxPQUFNLEVBQ0ZELFFBQUFBLEVBQ0FFLFVBQU8sRUFDUEMsV0FBUSxLQUNSQyxXQUFVLEVBQ1ZDLFdBQUFBLEVBQ0FDLFdBQVcsRUFDWEMsU0FBQUEsRUFDQUMsVUFBQUEsRUFDQUMsV0FBUyxFQUNUQyxLQUFBQSxLQUNBQyxRQUFBQSxLQUNBQyxNQUFNLEdBQ05DLFNBQVMsRUFDVEMsY0FkRSxFQWVGQyxJQUFBQSxFQUNBQyxNQUFBQSxHQUNBQyxZQWpCRSxFQWtCRkMsVUFsQkUsR0FtQkZDLE9BQUFBLEdBQ0FDLFNBQUFBLEdBQ0FDLFVBckJFLEdBc0JGQyxZQXRCRSxHQXVCRkMsV0FBVyxHQUNYQyxXQUFBQSxFQUNBQyxVQUFBQSxHQUNBQyxNQUFBQSxFQUNBQyxZQUFXLEVBQ1hDLFdBNUJFLEVBNkJGQyxPQUFBQSxLQUNBQyxZQUFXLGlEQUNYQyxLQUFBQSxDQUNBQyxTQUFBQSxJQUNNQyxRQUFBLENBbkNXQyxhQUFBLFdBdUNyQkQsSUFBU0UsRUFBQUMsS0FDTEYsRUFBQUEsUUFBY0csT0FBQSxXQUNORixJQUFBQSxFQUFKRyxLQUFBQyxJQUFBQyxPQUFBQyxZQUFBQyxTQUFBQyxnQkFBQUMsVUFBQUYsU0FBQUcsS0FBQUQsV0FDQUUsRUFBaUJDLEVBQUEscUJBQVlDLFNBQUFDLElBQ3JCQyxFQUFrQlosRUFBU0Us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RCxjQUhvQixFQUlwQkUsUUFBQUEsSUFFQUMsRUFBQUEsZUFBQUEsTUFOb0IsQ0FPcEJDLFlBQVEsRUFQWkgsZUFBQSxFQVNFRCxVQUFBLEVBQ0VGLGNBQVksSUFDWkcsY0FBQUEsRUFDQUQsY0FIbUIsRUFJbkJFLFFBQUFBLElBRUFDLElBQUFBLEVBQUFBLFNBTm1CRSxlQUFBLHVCQU9uQkQsRUFBUXZJLFNBQUF3SSxlQUFBLHdCQVBXQyxFQUF2QkMsVUFBQUMsSUFBQSxVQVNBQyxFQUFJSCxVQUFhekksSUFBU3dJLFVBTzFCL0ksRUFBQXpCLFVBQUEsRUFBQXlCLEVBQUFvSiIsImZpbGUiOiJpbmRleF9tb2JpbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaW5kZXhfdmlldyA9IG5ldyBWdWUoe1xyXG4gICAgZWw6IFwiI2FwcFwiLFxyXG4gICAgZGF0YToge1xyXG4gICAgICAgIGdhbWVQb3A6IGZhbHNlLFxyXG4gICAgICAgIGV4UG9wOiBmYWxzZSxcclxuICAgICAgICBlZ2dQb3A6IGZhbHNlLFxyXG4gICAgICAgIHByb2RzUG9wOiBmYWxzZSxcclxuICAgICAgICBwZXJkYXRhUG9wOiBudWxsLCAgLy8g5aGr5a+r6KGo5ZauXHJcbiAgICAgICAga3ZpZGVvUG9wOiBmYWxzZSxcclxuICAgICAgICBmaW5pc2hQb3A6IGZhbHNlLFxyXG4gICAgICAgIGpvaW5lZFBvcDogZmFsc2UsXHJcbiAgICAgICAgcm9sZVBvcDogZmFsc2UsXHJcbiAgICAgICAgYXdhcmRQb3A6IGZhbHNlLFxyXG4gICAgICAgIHZpZGVvX3N0ZXA6IDAsXHJcbiAgICAgICAgcm9vbTogbnVsbCxcclxuICAgICAgICB0aW1lb3V0OiBudWxsLFxyXG4gICAgICAgIHRpbWVyOiA2MCxcclxuICAgICAgICBvcGVuaW5nOiBmYWxzZSxcclxuICAgICAgICB3aW5kb3dfY2xvc2U6ZmFsc2UsXHJcbiAgICAgICAgc2VjOjMsXHJcbiAgICAgICAgdG9rZW46IFwiXCIsXHJcbiAgICAgICAgcHJvYmFiaWxpdHk6IDAsXHJcbiAgICAgICAgYmFzZTY0SW1nOiBcIlwiLFxyXG4gICAgICAgIGNhcEtleTogXCJcIixcclxuICAgICAgICBpbnB1dENhcDogXCJcIixcclxuICAgICAgICBpbnB1dE5hbWU6IFwiXCIsXHJcbiAgICAgICAgaW5wdXRNb2JpbGU6IFwiXCIsXHJcbiAgICAgICAgaW5wdXRFbWFpbDogXCJcIixcclxuICAgICAgICBsdWNreUF3YXJkOiAwLFxyXG4gICAgICAgIGF3YXJkSXRlbTogXCJcIixcclxuICAgICAgICBtdXRlOnRydWUsXHJcbiAgICAgICAgY2hlY2thZ3JlZTogZmFsc2UsXHJcbiAgICAgICAgY2hlY2t3aXNoOiBmYWxzZSxcclxuICAgICAgICBsb25lbHk6IG51bGwsXHJcbiAgICAgICAgcm9vbV9kb21haW46ICdodHRwczovL25vZGUtY2FycmVmb3VyMjAxOTAxLmF6dXJld2Vic2l0ZXMubmV0JywgLy8naHR0cHM6Ly9ub2RlLWNhcnJlZm91cjIwMTkwMS5henVyZXdlYnNpdGVzLm5ldCcgaHR0cHM6Ly9jYXJyZWZvdXIyMDE5MDEuaGVyb2t1YXBwLmNvbVxyXG4gICAgICAgIGdhbWU6IHtcclxuICAgICAgICAgICAgcHJvZFBvcDpmYWxzZVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgd2luZG93U2Nyb2xsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHdpbmRvd1Njcm9sbFRvcCA9IE1hdGgubWF4KHdpbmRvdy5wYWdlWU9mZnNldCwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApO1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0b3BIZWlnaHQgPSAkKCcjZWFzdGVyLWVnZy10aXRsZScpLm9mZnNldCgpLnRvcDtcclxuICAgICAgICAgICAgICAgIGlmICh3aW5kb3dTY3JvbGxUb3AgPiBzdG9wSGVpZ2h0IC0gdm0ubmF2SGVpZ2h0ICsgMzApIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zdG9wSXNzdWUoXCIubmF2XCIsIHN0b3BIZWlnaHQgLSB2bS5uYXZIZWlnaHQgLSAxMjApO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0b3BJc3N1ZShcIi53aW5kb3dcIiwgc3RvcEhlaWdodCAtIHZtLm5hdkhlaWdodCAtIDEyMCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLm92ZXJTdG9wSXNzdWUoXCIubmF2XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLm92ZXJTdG9wSXNzdWUoXCIud2luZG93XCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdhbWVPcGVuOiBmdW5jdGlvbiAoKSB7IFxyXG4gICAgICAgICAgICBpZiAodGhpcy5lbmREYXRlKCkpIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0KCfmtLvli5Xlt7LntZDmnZ/vvIwyLzI45YmN5bCH5pa85rS75YuV57ay56uZ5YWs5biD5b6X542O5ZCN5ZauJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5nYW1lUG9wID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5uYXZJc3N1ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNsZWFyRGF0YSgpXHJcbiAgICAgICAgfSxcclxuICAgICAgICBhbGxQb3B1cENsb3NlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgICAgIHZtLmdhbWVQb3AgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uZXhQb3AgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uZWdnUG9wID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnByb2RzUG9wID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLmt2aWRlb1BvcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5maW5pc2hQb3AgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uam9pbmVkUG9wID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnJvbGVQb3AgPSBmYWxzZTsgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZtLmF3YXJkUG9wID0gZmFsc2U7ICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2bS5nYW1lLnByb2RQb3AgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0ucGVyZGF0YVBvcCA9IG51bGw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBuYXZJc3N1ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgaXNzdWUgPSAkKFwibmF2XCIpLmhhc0NsYXNzKCd1cGlzc3VlJyk7XHJcbiAgICAgICAgICAgIGlmIChpc3N1ZSkge1xyXG4gICAgICAgICAgICAgICAgJChcIm5hdlwiKS5yZW1vdmVDbGFzcygndXBpc3N1ZScpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJChcIm5hdlwiKS5hZGRDbGFzcygndXBpc3N1ZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhd2FyZElzc3VlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5hbGVydCgn5b6X542O5ZCN5Zau5bCH5pa8MjAxOS8yLzI45YmN5YWs5biD77yM5pWs6KuL5pyf5b6F44CCJyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzdGVwX25leHQ6IGZ1bmN0aW9uICh2YWwpIHsgXHJcbiAgICAgICAgICAgIHRoaXMudmlkZW9fc3RlcCA9IHZhbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHN0b3BJc3N1ZTogZnVuY3Rpb24gKGl0ZW0sIGhlaWdodCkge1xyXG4gICAgICAgICAgICAkKGl0ZW0pLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJChpdGVtKS5jc3MoJ3RvcCcsIGhlaWdodCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBvdmVyU3RvcElzc3VlOiBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAkKGl0ZW0pLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgJChpdGVtKS5jc3MoJ3RvcCcsIDApO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY3JlYXRlUm9vbTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lbmREYXRlKCkpIHtcclxuICAgICAgICAgICAgICAgIGFsZXJ0KCfmtLvli5Xlt7LntZDmnZ/vvIwyLzI45YmN5bCH5pa85rS75YuV57ay56uZ5YWs5biD5b6X542O5ZCN5ZauJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHVybFF1ZXJ5ID0gZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKSxcclxuICAgICAgICAgICAgICAgIHNlYXJjaCA9IFwiXCIsXHJcbiAgICAgICAgICAgICAgICByb29tX2lkID0gZ3VpZCgpO1xyXG4gICAgICAgICAgICBpZiAodXJsUXVlcnkgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF1cmxRdWVyeS5tYXRjaCgvcm9vbUlkL2cpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoID0gYCR7dXJsUXVlcnl9JnJvb21JZD0ke3Jvb21faWR9YFxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWFyY2ggPSBgJHt1cmxRdWVyeS5zcGxpdCgncm9vbUlkPScpWzBdLnJlcGxhY2UoLyZeLywnJyl9JnJvb21JZD0ke3Jvb21faWR9YDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaCA9IGByb29tSWQ9JHtyb29tX2lkfWBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgZG9jdW1lbnQudGl0bGUsIGA/JHtzZWFyY2h9YCk7XHJcbiAgICAgICAgICAgIHRoaXMucm9vbSA9IG5ldyBSb29tcyh7XHJcbiAgICAgICAgICAgICAgICBndG1fZXZlbnQ6IHRoaXMuZ2FFdmFudCxcclxuICAgICAgICAgICAgICAgIGRvbWFpbjogdGhpcy5yb29tX2RvbWFpbixcclxuICAgICAgICAgICAgICAgIG5leHRTdGVwOiB0aGlzLnN0ZXBfbmV4dCxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuYXdhcmRJdGVtID0gXCIwXCI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRUaW1lcjogZnVuY3Rpb24gKCkgeyBcclxuICAgICAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICAgICAgdm0udGltZXIgPSA2MDtcclxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh2bS50aW1lb3V0KTtcclxuICAgICAgICAgICAgdm0udGltZW91dCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZtLnRpbWVyLS07XHJcbiAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdmlkZW9fc3RhcnQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy5yb29tLnZpZGVvX3N0YXJ0KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlZ2dSYW5kb20oeCkge1xyXG4gICAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqeCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB2aWRlb1BsYXk6IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgdmlkZW9JZCA9IHZtLnZpZGVvX2xpbmtbaW5kZXggLSAxXTtcclxuICAgICAgICAgICAgdm0ua3ZpZGVvUG9wID0gdHJ1ZTtcclxuICAgICAgICAgICAga3ZpZGVvLmxvYWRWaWRlb0J5SWQodmlkZW9JZCk7XHJcbiAgICAgICAgICAgIGt2aWRlby51bk11dGUoKTtcclxuICAgICAgICAgICAga3ZpZGVvLnBsYXlWaWRlbygpO1xyXG4gICAgICAgICAgICAvLyB2bS5wb3B1cE9wZW4oKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZpZGVvUGxheUxpbms6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICAgICAgdm0ua3ZpZGVvUG9wID0gdHJ1ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZpZGVvQ2xvc2U6IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgICAgICB2bS5rdmlkZW9Qb3AgPSBmYWxzZTtcclxuICAgICAgICAgICAga3ZpZGVvLnN0b3BWaWRlbygpO1xyXG4gICAgICAgICAgICB2bS5wb3B1cENsb3NlKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICByb29tQ29ubmV0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm9vbS5jb25uZWN0KClcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZpZGVvX211dGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucm9vbS5wbGF5ZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubXV0ZSA9ICF0aGlzLm11dGU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yb29tLnBsYXllci5pc011dGVkKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb20ucGxheWVyLnVuTXV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb20ucGxheWVyLm11dGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdmlkZW9fZG9uZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLnJvb20ucGxheWVyLnNlZWtUbygxMTcpXHJcbiAgICAgICAgfSxcclxuICAgICAgICB2aWRlb19wbGF5OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm9vbS5wbGF5ZXIucGxheVZpZGVvKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB2aWRlb19jbG9zZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLnJvb20uc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICAgICAgdGhpcy5yb29tID0gbnVsbDtcclxuICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsIGRvY3VtZW50LnRpdGxlLCBkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2guc3BsaXQoJ3Jvb21JZCcpWzBdKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxvbmVseV9wbGF5OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgICAgIHZtLnJvb20uc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICAgICAgdm0ubG9uZWx5ID0gbmV3IFlULlBsYXllcignbG9uZWx5LS1wbGF5ZXInLCB7XHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcclxuICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXHJcbiAgICAgICAgICAgICAgICB2aWRlb0lkOiAnMnpPMnF6ZWhmMUEnLFxyXG4gICAgICAgICAgICAgICAgcGxheWVyVmFyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdjb250cm9scyc6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2Rpc2FibGVrYic6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3JlbCc6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2VuYWJsZWpzYXBpJzogMSxcclxuICAgICAgICAgICAgICAgICAgICAnc2hvd2luZm8nOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICdpdl9sb2FkX3BvbGljeSc6IDMsXHJcbiAgICAgICAgICAgICAgICAgICAgJ21vZGVzdGJyYW5kaW5nJzogMSxcclxuICAgICAgICAgICAgICAgICAgICAncGxheWxpc3QnOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAnc3RhcnQnOiAzLFxyXG4gICAgICAgICAgICAgICAgICAgICdwbGF5c2lubGluZSc6IDFcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBldmVudHM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnb25SZWFkeSc6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUudGFyZ2V0LnVuTXV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5wbGF5VmlkZW8oKTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICdvblN0YXRlQ2hhbmdlJzogZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kYXRhID09IFlULlBsYXllclN0YXRlLkVOREVEKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zdGVwX25leHQoNCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb25lbHkgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2codm0ubG9uZWx5KVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbG9uZWx5X2Nsb3NlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9uZWx5LnN0b3BWaWRlbygpO1xyXG4gICAgICAgICAgICAkKFwiI2xvbmVseS0tcGxheWVyXCIpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAkKFwiLmxvbmVseS1jb250ZW50XCIpLmFwcGVuZChcIjxkaXYgaWQ9J2xvbmVseS0tcGxheWVyJy8+XCIpO1xyXG4gICAgICAgICAgICB0aGlzLmxvbmVseSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMudmlkZW9fY2xvc2UoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9wZW5fdmlkZW9fZm9ybTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgICAgICB2bS5nZXRUb2tlbigpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgdm0udG9rZW4gPSByZXMudG9rZW47XHJcbiAgICAgICAgICAgICAgICB2bS5wZXJkYXRhUG9wID0gJ3Jvb20nO1xyXG4gICAgICAgICAgICAgICAgdm0ucm9vbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB2bS5zYXZlQ2FwdGNoYSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgd2F0Y2g6IHtcclxuICAgICAgICB2aWRlb19zdGVwOiBmdW5jdGlvbiAobmV3VmFsKSB7XHJcbiAgICAgICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgICAgIHN3aXRjaCAobmV3VmFsKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uJG5leHRUaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnJvb20uc3RhdHVzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2bS5yb29tLmNvbm5lY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yb29tLmNyZWF0ZVFSKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZtLnJvb20ua2V5bWFuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zZXRUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICB2bS4kbmV4dFRpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHZtLnRpbWVvdXQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yb29tLllUaW5pdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uJG5leHRUaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm9vbS52aWRlb19jdXQgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWMgPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiLmNvbnRyb2xsXCIpLmFkZENsYXNzKFwic3RhcnRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWNfZG93biA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHZtLnJvb20ud2lkdGgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWMtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5zZWMgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2VjX2Rvd24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIi5jb250cm9sbFwiKS5yZW1vdmVDbGFzcyhcInN0YXJ0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJvb20udmlkZW9fY3V0ID0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm9vbS5zdGF0dXMgPSAncGxheWluZydcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnJvb20ucGxheWVyLnNlZWtUbykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm9vbS5wbGF5ZXIuc2Vla1RvKDAsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm9vbS5wbGF5ZXIucGxheVZpZGVvKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAzMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAxNTAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvb20uc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGltZXI6IGZ1bmN0aW9uICh2YWwpIHtcclxuICAgICAgICAgICAgaWYgKHZhbCA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZW91dCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVyID0gNjA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJvb20uY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcm9vbToge1xyXG4gICAgICAgICAgICBkZWVwOiB0cnVlLFxyXG4gICAgICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iail7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5zdGF0dXMgPT0gXCJyb29tX292ZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnJWN1c2VyIGZ1bGwnLCAnY29sb3I6cmVkOycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgn5b2x5buz5Lq65pW45bey5ru/77yM54Sh5rOV5Yqg5YWlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJvb20uc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm9vbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouc3RhdHVzID09IFwid2FpdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnZpZGVvX3N0ZXAgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnN0YXR1cyA9PSBcImJlZm9yZV9wbGF5XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdm0udmlkZW9fc3RlcCA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouc3RhdHVzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnZpZGVvX3N0ZXAgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcygnX2ZyZWV6ZScpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0udGltZW91dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHZtLnRpbWVvdXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkKFwiYm9keVwiKS5yZW1vdmVDbGFzcygnX2ZyZWV6ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5zY3JvbGxUb3AoJChcIiNrdi1ib3R0b21cIikub2Zmc2V0KCkudG9wIC0gNTApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGNvbXB1dGVkOiB7XHJcbiAgICAgICAgc29ydENsYXNzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAnY2VudGVyJzogdGhpcy5yb29tLnNvcnQgPT0gMCxcclxuICAgICAgICAgICAgICAgICdsZWZ0JzogdGhpcy5yb29tLnNvcnQgPT0gMSxcclxuICAgICAgICAgICAgICAgICdyaWdodCc6IHRoaXMucm9vbS5zb3J0ID09IDJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdmlkZW9DbGFzczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgJ3dvcmQnOiB0aGlzLnZpZGVvX3N0ZXAgPT0gMCB8fCB0aGlzLnZpZGVvX3N0ZXAgPT0gNCAsXHJcbiAgICAgICAgICAgICAgICAnam9pbic6IHRoaXMudmlkZW9fc3RlcCA9PSAxLFxyXG4gICAgICAgICAgICAgICAgJ3BsYXknOiB0aGlzLnZpZGVvX3N0ZXAgPT0gMixcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWVkaWFTdHlsZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgJ3dpZHRoJzogYCR7dGhpcy5yb29tLndpZHRofXB4YFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBib3JkZXJTdHlsZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgJ2JvcmRlci13aWR0aCc6IGAke3RoaXMucm9vbS53aWR0aCAvIDJ9cHhgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgbW91bnRlZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgLy8gJChcIi5sb2FkaW5nLXBhZ2VcIikuYWRkQ2xhc3MoJ25vbmUnKTtcclxuICAgICAgICAvLyB3aW5kb3cgZml4ZWRcclxuICAgICAgICB2bS5zaG93UHJvaigpO1xyXG4gICAgICAgIC8vIHZtLnNhdmVDYXB0Y2hhKCk7XHJcbiAgICAgICAgaWYgKGZpbmRHZXRQYXJhbWV0ZXIoXCJyb29tSWRcIikpIHtcclxuICAgICAgICAgICAgdm0ucm9vbSA9IG5ldyBSb29tcyh7XHJcbiAgICAgICAgICAgICAgICBndG1fZXZlbnQ6IHZtLmdhRXZhbnQsXHJcbiAgICAgICAgICAgICAgICBkb21haW46IHZtLnJvb21fZG9tYWluLFxyXG4gICAgICAgICAgICAgICAgbmV4dFN0ZXA6IHZtLnN0ZXBfbmV4dCxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLmF3YXJkSXRlbSA9IFwiMFwiO1xyXG4gICAgICAgICAgICB2bS5yb29tQ29ubmV0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLmlzUEMgPSBmYWxzZTtcclxuICAgICAgICAkKFwiI3ZpZGVvLWdyb3VwXCIpLnNsaWNrKHtcclxuICAgICAgICAgICAgY2VudGVyTW9kZTogdHJ1ZSxcclxuICAgICAgICAgICAgdmFyaWFibGVXaWR0aDogdHJ1ZSxcclxuICAgICAgICAgICAgYXV0b3BsYXk6IHRydWUsXHJcbiAgICAgICAgICAgIGF1dG9wbGF5U3BlZWQ6IDIwMDAsXHJcbiAgICAgICAgICAgIHBhdXNlT25Ib3ZlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHBhdXNlT25Gb2N1czogZmFsc2UsXHJcbiAgICAgICAgICAgIGFycm93czogZmFsc2UsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJChcIiNnYW1lLXNsaWNrXCIpLnNsaWNrKHtcclxuICAgICAgICAgICAgY2VudGVyTW9kZTogdHJ1ZSxcclxuICAgICAgICAgICAgdmFyaWFibGVXaWR0aDogdHJ1ZSxcclxuICAgICAgICAgICAgYXV0b3BsYXk6IHRydWUsXHJcbiAgICAgICAgICAgIGF1dG9wbGF5U3BlZWQ6IDIwMDAsXHJcbiAgICAgICAgICAgIHBhdXNlT25Ib3ZlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHBhdXNlT25Gb2N1czogZmFsc2UsXHJcbiAgICAgICAgICAgIGFycm93czogZmFsc2UsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIHdpbmRvd0xlZnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2luZG93LWxvYWRpbmctbGVmdCcpO1xyXG4gICAgICAgIHZhciB3aW5kb3dSaWdodCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3ctbG9hZGluZy1yaWdodCcpO1xyXG4gICAgICAgIHdpbmRvd0xlZnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgICAgICAgd2luZG93UmlnaHQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblxyXG4gICAgICAgIC8vIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyAgICAgdm0uZ2FtZSA9IG5ldyBHbWFlcyh7XHJcbiAgICAgICAgLy8gICAgICAgICBwcm9iYWJpbGl0eSA6IHZtLnByb2JhYmlsaXR5LFxyXG4gICAgICAgIC8vICAgICB9KTtcclxuICAgICAgICAvLyB9LDEwMDApXHJcbiAgICAgICAgdm0uYXdhcmRQb3AgPSB0cnVlOyB2bS5wb3B1cE9wZW4oKTtcclxuICAgIH1cclxufSlcclxuIl19
