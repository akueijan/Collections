"use strict";var survey_view=new Vue({el:"#app",data:{question:"",answer:"",example:"",user:"",MID:""},methods:{getQuestion:function(){var e=this;return e.logger(3,"call api: GetSurveyQuestion","getQuestion"),$.ajax({url:friendo_url+"GetSurveyQuestion",methods:"POST",headers:{Token:e.webToken},success:function(t){e.logger(3,{name:"GetSurveyQuestion",result:t},"getQuestion")},error:function(t,o,n){console.log("GetSurveyQuestion error:",t.statusText),e.logger(0,{name:"GetSurveyQuestion",httpStatus:o,errorMsg:t.statusText},"getQuestion")},dataType:"json"})},getUserToken:function(){var e=this;return e.logger(3,"check User Token","getUserToken"),new Promise(function(t){e.MID=findGetParameter("memberID"),e.MID?(e.logger(3,"get MID"+e.MID,"getUserToken"),e.getAccessToken(findGetParameter("memberID")).then(function(t){e.user=t})):checkCookie("_AT")?(e.logger(3,"get cookie _AT"+checkCookie("_AT"),"getUserToken"),e.user=checkCookie("_AT")):(e.logger(2,"no data _AT and MID","getUserToken"),location="index.html"),t(e.user)})},submitSurvey:function(e){var t=this;if(""!=t.answer){if(!t.loading){var o={answer:t.answer};t.loading=!0,t.logger(3,{text:"call api: SubmitSurvey",data:{Authorization:t.user,post_data:o}},"submitSurvey"),$.ajax({url:friendo_url+"SubmitSurvey",method:"POST",headers:{Token:t.webToken,Authorization:t.user},data:o,success:function(e){t.logger(3,{name:"GetSurveyQuestion",result:e},"getQuestion")},error:function(e,o,n){console.log("SubmitSurvey error:",e.statusText),t.logger(0,{name:"GetSurveyQuestion",httpStatus:o,errorMsg:e.statusText},"GetAccessToken")},dataType:"json"}).then(function(e){if(e.result){if(t.gaEvant("click","survey_填寫完成","survey_填寫完成"),findGetParameter("memberID"))switch(device.os){case"ios":window.webkit.messageHandlers.answerFinsh.postMessage("test");break;case"android":window.gdcard.answerFinish()}else location="scratchcard.html";t.loading=!1}})}}else alert("請填寫答案")}},mounted:function(){var e=this;$("body").loadpage("init",{async:!0}),$(window).on("online offline",e.checkOnline),e.getUserToken().then(function(){e.getQuestion().then(function(t){e.gaEvant("result","survey_填寫問卷","survey_填寫問卷"),t.result?(e.question=t.data.Question,e.example=t.data.Example,$("body").loadpage("close")):window.location.reload()})})}});