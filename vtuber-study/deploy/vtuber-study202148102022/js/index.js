"use strict";var index_view=new Vue({el:"#app",data:{},methods:{},mounted:function(){var c={bgColor:"#212121",light:{x:-1,y:1,z:-1},eyes:"sorrow",eyesInt:0,mouth:"A",mouthInt:0,head:{x:0,y:0,z:0},chest:{x:0,y:0,z:0},leftUpperArm:{x:0,y:0,z:0},leftLowerArm:{x:0,y:0,z:0},leftHand:{x:0,y:0,z:0},leftUpperLeg:{x:0,y:0,z:0},leftLowerLeg:{x:0,y:0,z:0},rightUpperArm:{x:0,y:0,z:0},rightLowerArm:{x:0,y:0,z:0},rightHand:{x:0,y:0,z:0},rightUpperLeg:{x:0,y:0,z:0},rightLowerLeg:{x:0,y:0,z:0},actionName:{none:!1,walk:!1,run:!1,wave:!1},actionEyes:{fun:!1,angry:!1,joy:!1,sorrow:!1}},e=new dat.GUI;e.addColor(c,"bgColor");var t=e.addFolder("light");t.add(c.light,"x",-1,1),t.add(c.light,"y",-1,1),t.add(c.light,"z",-1,1),e.add(c,"eyesInt",0,10),e.add(c,"mouth",["A","E","I","O","U"]),e.add(c,"mouthInt",0,10);t=e.addFolder("head");t.add(c.head,"x",-2,2),t.add(c.head,"y",-2,2),t.add(c.head,"z",-2,2);t=e.addFolder("chest");t.add(c.chest,"x",-2,2),t.add(c.chest,"y",-2,2),t.add(c.chest,"z",-2,2);t=e.addFolder("leftUpperArm");t.add(c.leftUpperArm,"x",-1,1),t.add(c.leftUpperArm,"y",-2,1),t.add(c.leftUpperArm,"z",-1,1);t=e.addFolder("leftLowerArm");t.add(c.leftLowerArm,"x",-1,1),t.add(c.leftLowerArm,"y",-5,5),t.add(c.leftLowerArm,"z",-1,1);t=e.addFolder("leftHand");t.add(c.leftHand,"x",-1,1),t.add(c.leftHand,"y",-2,2),t.add(c.leftHand,"z",-1,1);t=e.addFolder("leftUpperLeg");t.add(c.leftUpperLeg,"x",-2,2),t.add(c.leftUpperLeg,"y",-5,5),t.add(c.leftUpperLeg,"z",-1,1);t=e.addFolder("leftLowerLeg");t.add(c.leftLowerLeg,"x",-2,2),t.add(c.leftLowerLeg,"y",-5,5),t.add(c.leftLowerLeg,"z",-1,1);t=e.addFolder("rightUpperArm");t.add(c.rightUpperArm,"x",-1,1),t.add(c.rightUpperArm,"y",-2,2),t.add(c.rightUpperArm,"z",-1,1);t=e.addFolder("rightLowerArm");t.add(c.rightLowerArm,"x",-1,1),t.add(c.rightLowerArm,"y",-5,5),t.add(c.rightLowerArm,"z",-1,1);t=e.addFolder("rightHand");t.add(c.rightHand,"x",-1,1),t.add(c.rightHand,"y",-2,2),t.add(c.rightHand,"z",-1,1);t=e.addFolder("rightUpperLeg");t.add(c.rightUpperLeg,"x",-2,2),t.add(c.rightUpperLeg,"y",-5,5),t.add(c.rightUpperLeg,"z",-1,1);t=e.addFolder("rightLowerLeg");t.add(c.rightLowerLeg,"x",-2,2),t.add(c.rightLowerLeg,"y",-5,5),t.add(c.rightLowerLeg,"z",-1,1);var r=void 0,o=void 0,t=e.addFolder("Actions");t.add(c.actionName,"none").name("none").listen().onChange(function(){if(E("none"),u)for(var e=0;e<u.length;e++)u[e].stop()}),t.add(c.actionName,"walk").name("walk").listen().onChange(function(){E("walk"),r={hierarchy:[{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,-10*Math.PI/180,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,10*Math.PI/180,0)).toArray(),time:600},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,-10*Math.PI/180,0)).toArray(),time:1200}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,-40*Math.PI/180,60*Math.PI/180)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,40*Math.PI/180,60*Math.PI/180)).toArray(),time:600},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,-40*Math.PI/180,60*Math.PI/180)).toArray(),time:1200}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,-40*Math.PI/180,-60*Math.PI/180)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,40*Math.PI/180,-60*Math.PI/180)).toArray(),time:600},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,-40*Math.PI/180,-60*Math.PI/180)).toArray(),time:1200}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-10*Math.PI/180,0,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(10*Math.PI/180,0,0)).toArray(),time:600},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-10*Math.PI/180,0,0)).toArray(),time:1200}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(10*Math.PI/180,0,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-10*Math.PI/180,0,0)).toArray(),time:600},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(10*Math.PI/180,0,0)).toArray(),time:1200}]}]},o=[THREE.VRMSchema.HumanoidBoneName.Chest,THREE.VRMSchema.HumanoidBoneName.LeftUpperArm,THREE.VRMSchema.HumanoidBoneName.RightUpperArm,THREE.VRMSchema.HumanoidBoneName.LeftUpperLeg,THREE.VRMSchema.HumanoidBoneName.RightUpperLeg],l(d,r,o);for(var e=0;e<u.length;e++)u[e].play()}),t.add(c.actionName,"run").name("run").listen().onChange(function(){E("run");var e=450;r={hierarchy:[{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-30*Math.PI/180,-20*Math.PI/180,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-30*Math.PI/180,20*Math.PI/180,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-30*Math.PI/180,-20*Math.PI/180,0)).toArray(),time:900}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-60*Math.PI/180,-40*Math.PI/180,60*Math.PI/180)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(40*Math.PI/180,-40*Math.PI/180,60*Math.PI/180)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-60*Math.PI/180,-40*Math.PI/180,60*Math.PI/180)).toArray(),time:900}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(60*Math.PI/180,-40*Math.PI/180,-60*Math.PI/180)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-40*Math.PI/180,-40*Math.PI/180,-60*Math.PI/180)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(60*Math.PI/180,-40*Math.PI/180,-60*Math.PI/180)).toArray(),time:900}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(.9,-90*Math.PI/180,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(1,-90*Math.PI/180,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(.9,-90*Math.PI/180,0)).toArray(),time:900}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-.8,90*Math.PI/180,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-.9,90*Math.PI/180,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-.8,90*Math.PI/180,0)).toArray(),time:900}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(60*Math.PI/180,0,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-40*Math.PI/180,0,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(60*Math.PI/180,0,0)).toArray(),time:900}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-40*Math.PI/180,0,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(60*Math.PI/180,0,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-40*Math.PI/180,0,0)).toArray(),time:900}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-90*Math.PI/180,0,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(20*Math.PI/180,0,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-90*Math.PI/180,0,0)).toArray(),time:900}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(20*Math.PI/180,0,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-90*Math.PI/180,0,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(20*Math.PI/180,0,0)).toArray(),time:900}]}]},o=[THREE.VRMSchema.HumanoidBoneName.Chest,THREE.VRMSchema.HumanoidBoneName.LeftUpperArm,THREE.VRMSchema.HumanoidBoneName.RightUpperArm,THREE.VRMSchema.HumanoidBoneName.LeftLowerArm,THREE.VRMSchema.HumanoidBoneName.RightLowerArm,THREE.VRMSchema.HumanoidBoneName.LeftUpperLeg,THREE.VRMSchema.HumanoidBoneName.RightUpperLeg,THREE.VRMSchema.HumanoidBoneName.LeftLowerLeg,THREE.VRMSchema.HumanoidBoneName.RightLowerLeg],l(d,r,o);for(var t=0;t<u.length;t++)u[t].play()}),t.add(c.actionName,"wave").name("wave").listen().onChange(function(){E("wave");var e=600;r={hierarchy:[{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,-10*Math.PI/180)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,10*Math.PI/180)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,-10*Math.PI/180)).toArray(),time:2*e}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,-2*Math.PI/180)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,2*Math.PI/180)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,-2*Math.PI/180)).toArray(),time:2*e}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(1,-10*Math.PI/180,1)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(1,10*Math.PI/180,1)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(1,-10*Math.PI/180,1)).toArray(),time:2*e}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(1,-2,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-.5,-2,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(1,-2,0)).toArray(),time:2*e}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-1,0,0)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-.8,0,0)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(-1,0,0)).toArray(),time:2*e}]},{keys:[{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,-1)).toArray(),time:0},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,-.9)).toArray(),time:e},{rot:(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,-1)).toArray(),time:2*e}]}]},o=[THREE.VRMSchema.HumanoidBoneName.Head,THREE.VRMSchema.HumanoidBoneName.Chest,THREE.VRMSchema.HumanoidBoneName.LeftUpperArm,THREE.VRMSchema.HumanoidBoneName.LeftLowerArm,THREE.VRMSchema.HumanoidBoneName.LeftHand,THREE.VRMSchema.HumanoidBoneName.RightUpperArm],l(d,r,o);for(var t=0;t<u.length;t++)u[t].play()});var a,n=e.addFolder("Eyes");for(a in c.actionEyes)!function(e){n.add(c.actionEyes,e).name(e).listen().onChange(function(){E(e),"fun"===e&&H(d,THREE.VRMSchema.BlendShapePresetName.A),"angry"===e&&H(d,THREE.VRMSchema.BlendShapePresetName.E),"joy"===e&&H(d,THREE.VRMSchema.BlendShapePresetName.O),"sorrow"===e&&H(d,THREE.VRMSchema.BlendShapePresetName.I),h.loop=THREE.LoopOnce,h.LoopOnce=!0,h.clampWhenFinished=!0,h.play()})}(a);function E(e){for(var t in c.actionName)c.actionName[t]=!1;for(var r in c.actionEyes)c.actionEyes[r]=!1;c.actionName[e]=!0,c.actionEyes[e]=!0}var i=document.getElementById("canvas"),M=new THREE.Scene,A=new THREE.PerspectiveCamera(90,i.clientWidth/i.clientHeight,.1,1e3);A.position.set(0,1,-1);var L=new THREE.WebGLRenderer;L.setPixelRatio(window.devicePixelRatio),L.setSize(i.clientWidth,i.clientHeight),L.setClearColor(2171169,1),i.appendChild(L.domElement),console.log("render: ",L);e=new THREE.OrbitControls(A,L.domElement);e.screenSpacePanning=!0,e.target.set(0,1,0),e.update();var f=new THREE.DirectionalLight(16777215);f.position.set(-1,1,-1).normalize(),M.add(f);var m=new THREE.Object3D;A.add(m);e=new THREE.GLTFLoader;e.crossOrigin="anonymous";var d=[],P=void 0,u=void 0,I=void 0,h=void 0;e.load("./static/QMO_facetest.vrm",function(e){THREE.VRM.from(e).then(function(e){M.add(e.scene),console.log(e),d.push(e),e.lookAt.target=m;var t=[new THREE.IK,new THREE.IK];new THREE.IKChain,new THREE.IKChain,THREE.VRMSchema.HumanoidBoneName.LeftUpperArm,THREE.VRMSchema.HumanoidBoneName.LeftLowerArm,THREE.VRMSchema.HumanoidBoneName.LeftHand,THREE.VRMSchema.HumanoidBoneName.RightUpperArm,THREE.VRMSchema.HumanoidBoneName.RightLowerArm,THREE.VRMSchema.HumanoidBoneName.RightHand;R(e,t,[],[],[])})});e=new THREE.GridHelper(10,10);M.add(e);e=new THREE.AxesHelper(5);M.add(e);document.body;var N=new THREE.Clock,l=function(r,o,a){P=[];for(var n=[],e=0;e<r.length;e++)!function(t){var e=a.map(function(e){return r[t].humanoid.getBoneNode(e)}),e=THREE.AnimationClip.parseAnimation(o,e);e.tracks.some(function(e){e.name=e.name.replace(/^\.bones\[([^\]]+)\].(position|quaternion|scale)$/,"$1.$2")}),P.push(new THREE.AnimationMixer(r[t].scene)),n.push(P[t].clipAction(e)),console.log(n),u=n}(e)},H=function(e,t){t=new THREE.NumberKeyframeTrack(e.blendShapeProxy.getBlendShapeTrackName(t),[0,.3,.6],[0,1,0]);I=new THREE.AnimationMixer(e.scene);t=new THREE.AnimationClip("blink",1,[t]);h=I.clipAction(t)},F=(new Date).getTime(),R=function e(t,r,o,a,n){var E=N.getDelta(),i=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.Head),m=(t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.Jaw),t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.Neck),t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.Chest)),d=(t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.Hips),t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.LeftEye),t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.LeftLowerArm)),u=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.LeftUpperArm),h=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.LeftHand),l=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.LeftLowerLeg),H=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.LeftUpperLeg),R=(t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.LeftFoot),t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.RightEye),t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.RightUpperArm)),w=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.RightLowerArm),T=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.RightHand),s=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.RightUpperLeg),y=t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.RightLowerLeg);t.humanoid.getBoneNode(THREE.VRMSchema.HumanoidBoneName.RightFoot);i.rotation.x=c.head.x,i.rotation.y=c.head.y,i.rotation.z=c.head.z,m.rotation.x=c.chest.x,m.rotation.y=c.chest.y,m.rotation.z=c.chest.z,u.rotation.x=c.leftUpperArm.x,u.rotation.y=c.leftUpperArm.y,u.rotation.z=c.leftUpperArm.z,d.rotation.x=c.leftLowerArm.x,d.rotation.y=c.leftLowerArm.y,d.rotation.z=c.leftLowerArm.z,h.rotation.x=c.leftHand.x,h.rotation.y=c.leftHand.y,h.rotation.z=c.leftHand.z,H.rotation.x=c.leftUpperLeg.x,H.rotation.y=c.leftUpperLeg.y,H.rotation.z=c.leftUpperLeg.z,l.rotation.x=c.leftLowerLeg.x,l.rotation.y=c.leftLowerLeg.y,l.rotation.z=c.leftLowerLeg.z,R.rotation.x=c.rightUpperArm.x,R.rotation.y=-c.rightUpperArm.y,R.rotation.z=-c.rightUpperArm.z,w.rotation.x=c.rightLowerArm.x,w.rotation.y=-c.rightLowerArm.y,w.rotation.z=-c.rightLowerArm.z,T.rotation.x=c.rightHand.x,T.rotation.y=-c.rightHand.y,T.rotation.z=-c.rightHand.z,s.rotation.x=c.rightUpperLeg.x,s.rotation.y=c.rightUpperLeg.y,s.rotation.z=c.rightUpperLeg.z,y.rotation.x=c.rightLowerLeg.x,y.rotation.y=c.rightLowerLeg.y,y.rotation.z=c.rightLowerLeg.z;var y=(new Date).getTime(),g=y-F;if(P)for(var p=0;p<P.length;p++)P[p].update(g);I&&I.update(E),F=y,t.blendShapeProxy.setValue(THREE.VRMSchema.BlendShapePresetName.Sorrow,c.mouthInt/10),"A"==c.mouth&&t.blendShapeProxy.setValue(THREE.VRMSchema.BlendShapePresetName.A,c.mouthInt/10),"E"==c.mouth&&t.blendShapeProxy.setValue(THREE.VRMSchema.BlendShapePresetName.E,c.mouthInt/10),"I"==c.mouth&&t.blendShapeProxy.setValue(THREE.VRMSchema.BlendShapePresetName.I,c.mouthInt/10),"O"==c.mouth&&t.blendShapeProxy.setValue(THREE.VRMSchema.BlendShapePresetName.O,c.mouthInt/10),"U"==c.mouth&&t.blendShapeProxy.setValue(THREE.VRMSchema.BlendShapePresetName.U,c.mouthInt/10),t.update(E),requestAnimationFrame(function(){return e(t,r,o,a,n)}),L.setClearColor(c.bgColor,1),f.position.set(c.light.x,c.light.y,c.light.z).normalize(),L.render(M,A)},w=0,T=0;i.addEventListener("mousemove",function(e){w=(e.clientX-.5*i.offsetWidth)/i.offsetHeight*1,T=(e.clientY-.5*i.offsetHeight)/i.offsetHeight*-1,(w=.8<=w?.8:w)<=-.8&&(w=-.8),(T=.1<=T?.1:T)<=-.45&&(T=-.45)})}});